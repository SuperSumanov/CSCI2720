{"ast":null,"code":"var _jsxFileName = \"C:\\\\University\\\\CSCI2720\\\\project\\\\CSCI2720\\\\client\\\\src\\\\pages\\\\MapPage.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useContext } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { AuthContext } from '../context/AuthContext'; // å‡è®¾ä½ æœ‰AuthContext\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MapPage = () => {\n  _s();\n  const {\n    isAuthenticated,\n    isLoading: authLoading\n  } = useContext(AuthContext);\n  const navigate = useNavigate();\n  const [selectedLocation, setSelectedLocation] = useState(null);\n  const [locationName, setLocationName] = useState('');\n  const [comments, setComments] = useState([]);\n  const [newComment, setNewComment] = useState('');\n  const [isCommentsPaneOpen, setIsCommentsPaneOpen] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState('');\n  const mapRef = useRef(null);\n  const mapInstanceRef = useRef(null);\n  const markersRef = useRef([]);\n  const paneRef = useRef(null);\n\n  // æ¨¡æ‹Ÿä½ç½®æ•°æ®ï¼ˆåœ¨å®é™…åº”ç”¨ä¸­åº”è¯¥ä»APIè·å–ï¼‰\n  const mockLocations = [{\n    id: '3110031',\n    name: 'Hong Kong Cultural Centre',\n    latitude: 22.2933,\n    longitude: 114.1699\n  }, {\n    id: '3110267',\n    name: 'Hong Kong City Hall',\n    latitude: 22.2819,\n    longitude: 114.1586\n  }, {\n    id: '3110565',\n    name: 'Ko Shan Theatre',\n    latitude: 22.3367,\n    longitude: 114.1875\n  }, {\n    id: '35510043',\n    name: 'Kwai Tsing Theatre',\n    latitude: 22.3536,\n    longitude: 114.1011\n  }, {\n    id: '35510044',\n    name: 'Sai Wan Ho Civic Centre',\n    latitude: 22.2822,\n    longitude: 114.2292\n  }, {\n    id: '35511887',\n    name: 'Ngau Chi Wan Civic Centre',\n    latitude: 22.3358,\n    longitude: 114.2092\n  }, {\n    id: '35517396',\n    name: 'Yuen Long Theatre',\n    latitude: 22.4450,\n    longitude: 114.0269\n  }, {\n    id: '35517495',\n    name: 'Tuen Mun Town Hall',\n    latitude: 22.3958,\n    longitude: 113.9731\n  }, {\n    id: '36310304',\n    name: 'Sha Tin Town Hall',\n    latitude: 22.3808,\n    longitude: 114.1869\n  }, {\n    id: '36310566',\n    name: 'Tai Po Civic Centre',\n    latitude: 22.4481,\n    longitude: 114.1669\n  }];\n\n  // APIåŸºç¡€URL - åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™ä¸ªåº”è¯¥ä»ç¯å¢ƒå˜é‡ä¸­è·å–\n  const API_BASE_URL = 'http://localhost:3000';\n\n  // æ£€æŸ¥ç™»å½•çŠ¶æ€ï¼Œå¦‚æœæœªç™»å½•åˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢\n  useEffect(() => {\n    if (!authLoading && !isAuthenticated) {\n      navigate('/login');\n    }\n  }, [isAuthenticated, authLoading, navigate]);\n\n  // å¤„ç†é”®ç›˜äº‹ä»¶\n  useEffect(() => {\n    const handleKeyDown = e => {\n      if (e.key === 'Escape' && isCommentsPaneOpen) {\n        closeCommentsPane();\n      }\n    };\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [isCommentsPaneOpen]);\n\n  // åˆå§‹åŒ–åœ°å›¾ - åªåœ¨è®¤è¯åæ‰§è¡Œ\n  useEffect(() => {\n    if (!isAuthenticated || authLoading) return; // å¦‚æœæœªè®¤è¯æˆ–æ­£åœ¨éªŒè¯ï¼Œä¸åˆå§‹åŒ–åœ°å›¾\n\n    const initMap = () => {\n      if (!mapInstanceRef.current && mapRef.current) {\n        mapInstanceRef.current = L.map(mapRef.current).setView([22.3193, 114.1694], 12);\n        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n          attribution: '&copy; OpenStreetMap contributors',\n          maxZoom: 18\n        }).addTo(mapInstanceRef.current);\n        addMarkersToMap(mockLocations);\n      }\n    };\n    initMap();\n\n    // å¤„ç†æµè§ˆå™¨å†å²\n    const handlePopState = () => {\n      const url = new URL(window.location.href);\n      const locationId = url.searchParams.get('location');\n      if (locationId) {\n        handleMarkerClick(locationId, false);\n      } else {\n        closeCommentsPane();\n      }\n    };\n    window.addEventListener('popstate', handlePopState);\n\n    // åˆå§‹URLå¤„ç†\n    const url = new URL(window.location.href);\n    const initialLocationId = url.searchParams.get('location');\n    if (initialLocationId) {\n      handleMarkerClick(initialLocationId, false);\n    }\n    return () => {\n      if (mapInstanceRef.current) {\n        mapInstanceRef.current.remove();\n        mapInstanceRef.current = null;\n      }\n      window.removeEventListener('popstate', handlePopState);\n    };\n  }, [isAuthenticated, authLoading]);\n\n  // å¦‚æœæ­£åœ¨éªŒè¯èº«ä»½ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€\n  if (authLoading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        minHeight: '100vh',\n        backgroundColor: '#f5f5f5'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: 'center',\n          padding: '2rem',\n          borderRadius: '8px',\n          backgroundColor: 'white',\n          boxShadow: '0 2px 10px rgba(0,0,0,0.1)'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Loading Map...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Please wait while we verify your session.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 13\n    }, this);\n  }\n\n  // å¦‚æœæœªè®¤è¯ï¼Œè¿”å›ç©ºï¼ˆä¼šè¢«useEffecté‡å®šå‘ï¼‰\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  // æ ·å¼å®šä¹‰\n  const styles = {\n    app: {\n      display: 'flex',\n      flexDirection: 'column',\n      minHeight: '100vh',\n      margin: 0,\n      padding: 0,\n      boxSizing: 'border-box',\n      fontFamily: \"'Arial', sans-serif\",\n      lineHeight: 1.6,\n      color: '#333',\n      position: 'relative'\n    },\n    header: {\n      background: 'linear-gradient(135deg, #2c3e50, #3498db)',\n      color: 'white',\n      padding: '1rem 2rem',\n      boxShadow: '0 2px 10px rgba(0, 0, 0, 0.1)',\n      zIndex: 1000,\n      display: 'flex',\n      justifyContent: 'space-between',\n      alignItems: 'center'\n    },\n    headerTitle: {\n      fontSize: '1.5rem',\n      margin: 0\n    },\n    main: {\n      flex: 1,\n      display: 'flex',\n      position: 'relative',\n      overflow: 'hidden'\n    },\n    mapContainer: {\n      flex: 1,\n      position: 'relative',\n      zIndex: 1\n    },\n    mainMap: {\n      width: '100%',\n      height: '100%'\n    },\n    // è¯„è®ºå¼¹çª—æ ·å¼\n    commentsPane: {\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      width: '350px',\n      height: '100%',\n      background: 'white',\n      boxShadow: '2px 0 20px rgba(0, 0, 0, 0.15)',\n      zIndex: 100,\n      transform: isCommentsPaneOpen ? 'translateX(0)' : 'translateX(-100%)',\n      transition: 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)',\n      display: 'flex',\n      flexDirection: 'column',\n      overflow: 'hidden'\n    },\n    paneHeader: {\n      padding: '1.5rem',\n      background: 'linear-gradient(135deg, #2c3e50, #3498db)',\n      color: 'white',\n      display: 'flex',\n      justifyContent: 'space-between',\n      alignItems: 'center',\n      flexShrink: 0\n    },\n    paneTitle: {\n      margin: 0,\n      fontSize: '1.1rem',\n      fontWeight: '500'\n    },\n    locationName: {\n      fontSize: '0.9rem',\n      opacity: 0.9,\n      marginTop: '0.25rem'\n    },\n    closeButton: {\n      background: 'rgba(255, 255, 255, 0.2)',\n      border: 'none',\n      color: 'white',\n      width: '32px',\n      height: '32px',\n      borderRadius: '50%',\n      cursor: 'pointer',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      transition: 'background 0.3s',\n      fontSize: '1.2rem',\n      flexShrink: 0\n    },\n    paneContent: {\n      flex: 1,\n      overflowY: 'auto',\n      padding: '1.5rem',\n      display: 'flex',\n      flexDirection: 'column'\n    },\n    // è¯„è®ºéƒ¨åˆ†\n    commentsSection: {\n      flex: 1,\n      display: 'flex',\n      flexDirection: 'column'\n    },\n    commentsCount: {\n      color: '#2c3e50',\n      marginBottom: '1rem',\n      paddingBottom: '0.75rem',\n      borderBottom: '2px solid #eee',\n      fontSize: '0.9rem',\n      fontWeight: '500'\n    },\n    commentsList: {\n      flex: 1,\n      overflowY: 'auto',\n      marginBottom: '1.5rem'\n    },\n    commentItem: {\n      padding: '1rem',\n      borderBottom: '1px solid #f0f0f0',\n      background: '#fafafa',\n      borderRadius: '8px',\n      marginBottom: '0.75rem'\n    },\n    commentHeader: {\n      display: 'flex',\n      justifyContent: 'space-between',\n      alignItems: 'center',\n      marginBottom: '0.5rem'\n    },\n    commentAuthor: {\n      fontWeight: 'bold',\n      color: '#2c3e50',\n      fontSize: '0.9rem'\n    },\n    commentDate: {\n      color: '#888',\n      fontSize: '0.8rem'\n    },\n    commentText: {\n      color: '#555',\n      lineHeight: 1.5,\n      fontSize: '0.9rem'\n    },\n    noComments: {\n      color: '#999',\n      textAlign: 'center',\n      padding: '3rem 1rem',\n      fontStyle: 'italic',\n      fontSize: '0.9rem'\n    },\n    // æ·»åŠ è¯„è®ºè¡¨å•\n    addCommentSection: {\n      background: '#f8f9fa',\n      padding: '1.5rem',\n      borderRadius: '8px',\n      border: '1px solid #eaeaea',\n      flexShrink: 0\n    },\n    commentFormTitle: {\n      color: '#2c3e50',\n      marginBottom: '1rem',\n      fontSize: '0.9rem',\n      fontWeight: '500'\n    },\n    commentTextarea: {\n      width: '100%',\n      padding: '0.75rem',\n      border: '1px solid #ddd',\n      borderRadius: '6px',\n      resize: 'vertical',\n      marginBottom: '1rem',\n      fontFamily: 'inherit',\n      fontSize: '0.9rem',\n      minHeight: '80px',\n      transition: 'border-color 0.3s',\n      boxSizing: 'border-box'\n    },\n    submitButton: {\n      background: '#3498db',\n      color: 'white',\n      border: 'none',\n      padding: '0.75rem 1.5rem',\n      borderRadius: '6px',\n      cursor: 'pointer',\n      fontSize: '0.9rem',\n      transition: 'background 0.3s',\n      width: '100%',\n      fontWeight: '500'\n    },\n    submitButtonHover: {\n      background: '#2980b9'\n    },\n    submitButtonDisabled: {\n      background: '#bdc3c7',\n      cursor: 'not-allowed'\n    },\n    errorMessage: {\n      color: '#e74c3c',\n      fontSize: '0.9rem',\n      marginBottom: '1rem',\n      padding: '0.5rem',\n      background: '#fdf2f2',\n      borderRadius: '4px',\n      border: '1px solid #f8d7da'\n    },\n    loadingIndicator: {\n      textAlign: 'center',\n      padding: '2rem',\n      color: '#666',\n      fontSize: '0.9rem'\n    },\n    // å åŠ å±‚\n    overlay: {\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 0,\n      background: 'rgba(0, 0, 0, 0.4)',\n      zIndex: 50,\n      opacity: isCommentsPaneOpen ? 1 : 0,\n      visibility: isCommentsPaneOpen ? 'visible' : 'hidden',\n      transition: 'opacity 0.3s, visibility 0.3s',\n      cursor: 'pointer'\n    }\n  };\n\n  // æ·»åŠ æ ‡è®°åˆ°åœ°å›¾\n  const addMarkersToMap = locationsData => {\n    if (!mapInstanceRef.current) return;\n\n    // æ¸…é™¤ç°æœ‰æ ‡è®°\n    markersRef.current.forEach(marker => {\n      if (marker && mapInstanceRef.current) {\n        mapInstanceRef.current.removeLayer(marker);\n      }\n    });\n    markersRef.current = [];\n\n    // åˆ›å»ºè‡ªå®šä¹‰å›¾æ ‡\n    const createCustomIcon = (isSelected = false) => {\n      return L.divIcon({\n        className: 'custom-marker',\n        html: `\n                    <div style=\"\n                        background: ${isSelected ? '#e74c3c' : '#3498db'};\n                        width: 36px;\n                        height: 36px;\n                        border-radius: 50%;\n                        border: 3px solid white;\n                        box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        color: white;\n                        font-weight: bold;\n                        font-size: 16px;\n                        transition: all 0.3s;\n                    \">\n                        <div style=\"transform: translateY(-1px)\">ğŸ“</div>\n                    </div>\n                `,\n        iconSize: [36, 36],\n        iconAnchor: [18, 36]\n      });\n    };\n\n    // æ·»åŠ æ–°æ ‡è®°\n    locationsData.forEach(location => {\n      const isSelected = selectedLocation === location.id;\n      const marker = L.marker([location.latitude, location.longitude], {\n        icon: createCustomIcon(isSelected)\n      }).addTo(mapInstanceRef.current).bindTooltip(location.name, {\n        direction: 'top',\n        offset: [0, -18],\n        opacity: 0.9,\n        className: 'map-tooltip'\n      });\n\n      // æ ‡è®°ç‚¹å‡»äº‹ä»¶\n      marker.on('click', () => {\n        handleMarkerClick(location.id, true);\n      });\n      markersRef.current.push(marker);\n    });\n  };\n\n  // ä»åç«¯APIè·å–è¯„è®º\n  const fetchComments = async locationId => {\n    if (!isAuthenticated) {\n      throw new Error('Authentication required');\n    }\n    setIsLoading(true);\n    setError('');\n    try {\n      // è°ƒç”¨åç«¯APIè·å–æŸä¸ªåœ°ç‚¹çš„æ‰€æœ‰è¯„è®º\n      const response = await fetch(`${API_BASE_URL}/comment/loc-all/${locationId}`, {\n        credentials: 'include' // åŒ…å«è®¤è¯ä¿¡æ¯\n      });\n      if (!response.ok) {\n        if (response.status === 401) {\n          throw new Error('Authentication required. Please log in again.');\n        }\n        throw new Error(`Failed to fetch comments: ${response.status} ${response.statusText}`);\n      }\n      const commentsData = await response.json();\n\n      // å°†åç«¯æ•°æ®è½¬æ¢ä¸ºå‰ç«¯éœ€è¦çš„æ ¼å¼\n      const formattedComments = commentsData.map(comment => ({\n        id: comment.commentId || comment._id,\n        locationId: comment.locationId,\n        username: comment.username || 'Anonymous',\n        text: comment.content,\n        date: new Date(comment.timestamp).toLocaleDateString('en-US', {\n          year: 'numeric',\n          month: 'short',\n          day: 'numeric'\n        }),\n        timestamp: comment.timestamp,\n        userId: comment.userId\n      }));\n      return formattedComments;\n    } catch (error) {\n      console.error('Error fetching comments:', error);\n      setError(`Failed to load comments: ${error.message}`);\n      return [];\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // å‘åç«¯APIæäº¤è¯„è®º\n  const submitComment = async commentData => {\n    if (!isAuthenticated) {\n      throw new Error('Authentication required');\n    }\n    setIsLoading(true);\n    setError('');\n    try {\n      // è·å–è®¤è¯tokenï¼ˆå‡è®¾å­˜å‚¨åœ¨localStorageä¸­ï¼‰\n      const token = localStorage.getItem('authToken');\n      const response = await fetch(`${API_BASE_URL}/comment/send`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(token && {\n            'Authorization': `Bearer ${token}`\n          })\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          locID: commentData.locationId,\n          content: commentData.text\n        })\n      });\n      if (!response.ok) {\n        if (response.status === 401) {\n          throw new Error('Authentication required. Please log in again.');\n        }\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || `Failed to submit comment: ${response.status}`);\n      }\n      const result = await response.json();\n\n      // è¿”å›æ–°åˆ›å»ºçš„è¯„è®º\n      return {\n        id: result.comment._id || Date.now(),\n        locationId: commentData.locationId,\n        username: commentData.username,\n        text: commentData.text,\n        date: new Date().toLocaleDateString('en-US', {\n          year: 'numeric',\n          month: 'short',\n          day: 'numeric'\n        }),\n        timestamp: new Date().toISOString()\n      };\n    } catch (error) {\n      console.error('Error submitting comment:', error);\n      setError(`Failed to submit comment: ${error.message}`);\n      throw error;\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // å¤„ç†æ ‡è®°ç‚¹å‡»\n  const handleMarkerClick = async (locationId, pushHistory = true) => {\n    if (!isAuthenticated) {\n      navigate('/login');\n      return;\n    }\n\n    // æ‰¾åˆ°ä½ç½®ä¿¡æ¯\n    const location = mockLocations.find(loc => loc.id === locationId);\n    if (!location) return;\n\n    // æ›´æ–°é€‰ä¸­çš„ä½ç½®\n    setSelectedLocation(locationId);\n    setLocationName(location.name);\n    try {\n      // ä»APIåŠ è½½è¯„è®º\n      const locationComments = await fetchComments(locationId);\n      setComments(locationComments);\n    } catch (error) {\n      // å¦‚æœè®¤è¯å¤±è´¥ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢\n      if (error.message.includes('Authentication')) {\n        navigate('/login');\n        return;\n      }\n    }\n\n    // æ‰“å¼€è¯„è®ºå¼¹çª—\n    setIsCommentsPaneOpen(true);\n\n    // æ›´æ–°URLå¹¶æ¨å…¥å†å²è®°å½•ï¼ˆå¦‚æœéœ€è¦ï¼‰\n    if (pushHistory) {\n      const url = new URL(window.location.href);\n      url.searchParams.set('location', locationId);\n      window.history.pushState({\n        locationId\n      }, '', url);\n    }\n\n    // é‡æ–°æ¸²æŸ“æ ‡è®°ä»¥æ›´æ–°é€‰ä¸­çŠ¶æ€\n    addMarkersToMap(mockLocations);\n\n    // å±…ä¸­æ˜¾ç¤ºé€‰ä¸­çš„æ ‡è®°\n    if (mapInstanceRef.current) {\n      mapInstanceRef.current.setView([location.latitude, location.longitude], 14);\n    }\n  };\n\n  // å…³é—­è¯„è®ºå¼¹çª—\n  const closeCommentsPane = () => {\n    setIsCommentsPaneOpen(false);\n    setSelectedLocation(null);\n    setLocationName('');\n    setComments([]);\n    setNewComment('');\n    setError('');\n\n    // æ›´æ–°URL\n    const url = new URL(window.location.href);\n    url.searchParams.delete('location');\n    window.history.pushState({}, '', url);\n\n    // é‡æ–°æ¸²æŸ“æ ‡è®°ä»¥æ¸…é™¤é€‰ä¸­çŠ¶æ€\n    addMarkersToMap(mockLocations);\n\n    // é‡ç½®åœ°å›¾è§†å›¾\n    if (mapInstanceRef.current) {\n      mapInstanceRef.current.setView([22.3193, 114.1694], 12);\n    }\n  };\n\n  // æ·»åŠ è¯„è®º\n  const handleAddComment = async () => {\n    if (!isAuthenticated) {\n      navigate('/login');\n      return;\n    }\n    if (newComment.trim() === '' || !selectedLocation) return;\n    try {\n      // æ¨¡æ‹Ÿå½“å‰ç”¨æˆ·ï¼ˆåœ¨å®é™…åº”ç”¨ä¸­åº”è¯¥ä»ç™»å½•çŠ¶æ€è·å–ï¼‰\n      const currentUser = localStorage.getItem('currentUser') || 'Current User';\n      const commentData = {\n        locationId: selectedLocation,\n        username: currentUser,\n        text: newComment.trim()\n      };\n\n      // æäº¤è¯„è®ºåˆ°åç«¯API\n      const newCommentObj = await submitComment(commentData);\n\n      // æ›´æ–°è¯„è®ºåˆ—è¡¨\n      setComments(prevComments => [...prevComments, newCommentObj]);\n      setNewComment('');\n    } catch (error) {\n      console.error('Failed to add comment:', error);\n      // å¦‚æœè®¤è¯å¤±è´¥ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢\n      if (error.message.includes('Authentication')) {\n        navigate('/login');\n      }\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: styles.app,\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      style: styles.header,\n      children: /*#__PURE__*/_jsxDEV(\"h1\", {\n        style: styles.headerTitle,\n        children: \"Cultural Events Hong Kong\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 674,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 673,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      style: styles.main,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: styles.mapContainer,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: mapRef,\n          style: styles.mainMap\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 680,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 679,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: paneRef,\n        style: styles.commentsPane,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: styles.paneHeader,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              style: styles.paneTitle,\n              children: locationName\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 690,\n              columnNumber: 29\n            }, this), locationName && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: styles.locationName,\n              children: \"Comments\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 692,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 689,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: closeCommentsPane,\n            style: styles.closeButton,\n            \"aria-label\": \"Close comments pane\",\n            children: \"\\xD7\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 697,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 688,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: styles.paneContent,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            style: styles.commentsSection,\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: styles.commentsCount,\n              children: [comments.length, \" \", comments.length === 1 ? 'Comment' : 'Comments']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 708,\n              columnNumber: 29\n            }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: styles.errorMessage,\n              children: error\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 713,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: styles.commentsList,\n              children: isLoading ? /*#__PURE__*/_jsxDEV(\"div\", {\n                style: styles.loadingIndicator,\n                children: \"Loading comments...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 720,\n                columnNumber: 37\n              }, this) : comments.length > 0 ? comments.map(comment => /*#__PURE__*/_jsxDEV(\"div\", {\n                style: styles.commentItem,\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  style: styles.commentHeader,\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    style: styles.commentAuthor,\n                    children: comment.username\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 727,\n                    columnNumber: 49\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    style: styles.commentDate,\n                    children: comment.date\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 730,\n                    columnNumber: 49\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 726,\n                  columnNumber: 45\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: styles.commentText,\n                  children: comment.text\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 734,\n                  columnNumber: 45\n                }, this)]\n              }, comment.id, true, {\n                fileName: _jsxFileName,\n                lineNumber: 725,\n                columnNumber: 41\n              }, this)) : /*#__PURE__*/_jsxDEV(\"div\", {\n                style: styles.noComments,\n                children: [\"No comments yet for this location.\", /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    marginTop: '0.5rem',\n                    fontSize: '0.8rem'\n                  },\n                  children: \"Be the first to share your experience!\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 742,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 740,\n                columnNumber: 37\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 718,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: styles.addCommentSection,\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: styles.commentFormTitle,\n                children: \"Add a Comment\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 750,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n                value: newComment,\n                onChange: e => setNewComment(e.target.value),\n                placeholder: \"Share your thoughts about this venue...\",\n                style: styles.commentTextarea,\n                rows: \"3\",\n                disabled: isLoading\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 753,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: handleAddComment,\n                style: {\n                  ...styles.submitButton,\n                  ...(newComment.trim() === '' || isLoading ? styles.submitButtonDisabled : {})\n                },\n                disabled: newComment.trim() === '' || isLoading,\n                children: isLoading ? 'Posting...' : 'Post Comment'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 761,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 749,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 707,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 706,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 684,\n        columnNumber: 17\n      }, this), isCommentsPaneOpen && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: styles.overlay,\n        onClick: closeCommentsPane\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 778,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 677,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"footer\", {\n      style: {\n        background: '#2c3e50',\n        color: 'white',\n        textAlign: 'center',\n        padding: '1rem',\n        fontSize: '0.9rem'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"\\xA9 2024 Cultural Events Web Application | Click on any marker to view and post comments\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 792,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 785,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 672,\n    columnNumber: 9\n  }, this);\n};\n_s(MapPage, \"eCC1chJNCiuY84uu0wzIQlFzg7k=\", false, function () {\n  return [useNavigate];\n});\n_c = MapPage;\nexport default MapPage;\nvar _c;\n$RefreshReg$(_c, \"MapPage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useContext","useNavigate","AuthContext","L","jsxDEV","_jsxDEV","MapPage","_s","isAuthenticated","isLoading","authLoading","navigate","selectedLocation","setSelectedLocation","locationName","setLocationName","comments","setComments","newComment","setNewComment","isCommentsPaneOpen","setIsCommentsPaneOpen","setIsLoading","error","setError","mapRef","mapInstanceRef","markersRef","paneRef","mockLocations","id","name","latitude","longitude","API_BASE_URL","handleKeyDown","e","key","closeCommentsPane","window","addEventListener","removeEventListener","initMap","current","map","setView","tileLayer","attribution","maxZoom","addTo","addMarkersToMap","handlePopState","url","URL","location","href","locationId","searchParams","get","handleMarkerClick","initialLocationId","remove","style","display","justifyContent","alignItems","minHeight","backgroundColor","children","textAlign","padding","borderRadius","boxShadow","fileName","_jsxFileName","lineNumber","columnNumber","styles","app","flexDirection","margin","boxSizing","fontFamily","lineHeight","color","position","header","background","zIndex","headerTitle","fontSize","main","flex","overflow","mapContainer","mainMap","width","height","commentsPane","top","left","transform","transition","paneHeader","flexShrink","paneTitle","fontWeight","opacity","marginTop","closeButton","border","cursor","paneContent","overflowY","commentsSection","commentsCount","marginBottom","paddingBottom","borderBottom","commentsList","commentItem","commentHeader","commentAuthor","commentDate","commentText","noComments","fontStyle","addCommentSection","commentFormTitle","commentTextarea","resize","submitButton","submitButtonHover","submitButtonDisabled","errorMessage","loadingIndicator","overlay","right","bottom","visibility","locationsData","forEach","marker","removeLayer","createCustomIcon","isSelected","divIcon","className","html","iconSize","iconAnchor","icon","bindTooltip","direction","offset","on","push","fetchComments","Error","response","fetch","credentials","ok","status","statusText","commentsData","json","formattedComments","comment","commentId","_id","username","text","content","date","Date","timestamp","toLocaleDateString","year","month","day","userId","console","message","submitComment","commentData","token","localStorage","getItem","method","headers","body","JSON","stringify","locID","errorData","catch","result","now","toISOString","pushHistory","find","loc","locationComments","includes","set","history","pushState","delete","handleAddComment","trim","currentUser","newCommentObj","prevComments","ref","onClick","length","value","onChange","target","placeholder","rows","disabled","_c","$RefreshReg$"],"sources":["C:/University/CSCI2720/project/CSCI2720/client/src/pages/MapPage.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useContext } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { AuthContext } from '../context/AuthContext'; // å‡è®¾ä½ æœ‰AuthContext\r\nimport L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\n\r\nconst MapPage = () => {\r\n    const { isAuthenticated, isLoading: authLoading } = useContext(AuthContext);\r\n    const navigate = useNavigate();\r\n    \r\n    const [selectedLocation, setSelectedLocation] = useState(null);\r\n    const [locationName, setLocationName] = useState('');\r\n    const [comments, setComments] = useState([]);\r\n    const [newComment, setNewComment] = useState('');\r\n    const [isCommentsPaneOpen, setIsCommentsPaneOpen] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n    \r\n    const mapRef = useRef(null);\r\n    const mapInstanceRef = useRef(null);\r\n    const markersRef = useRef([]);\r\n    const paneRef = useRef(null);\r\n\r\n    // æ¨¡æ‹Ÿä½ç½®æ•°æ®ï¼ˆåœ¨å®é™…åº”ç”¨ä¸­åº”è¯¥ä»APIè·å–ï¼‰\r\n    const mockLocations = [\r\n        { id: '3110031', name: 'Hong Kong Cultural Centre', latitude: 22.2933, longitude: 114.1699 },\r\n        { id: '3110267', name: 'Hong Kong City Hall', latitude: 22.2819, longitude: 114.1586 },\r\n        { id: '3110565', name: 'Ko Shan Theatre', latitude: 22.3367, longitude: 114.1875 },\r\n        { id: '35510043', name: 'Kwai Tsing Theatre', latitude: 22.3536, longitude: 114.1011 },\r\n        { id: '35510044', name: 'Sai Wan Ho Civic Centre', latitude: 22.2822, longitude: 114.2292 },\r\n        { id: '35511887', name: 'Ngau Chi Wan Civic Centre', latitude: 22.3358, longitude: 114.2092 },\r\n        { id: '35517396', name: 'Yuen Long Theatre', latitude: 22.4450, longitude: 114.0269 },\r\n        { id: '35517495', name: 'Tuen Mun Town Hall', latitude: 22.3958, longitude: 113.9731 },\r\n        { id: '36310304', name: 'Sha Tin Town Hall', latitude: 22.3808, longitude: 114.1869 },\r\n        { id: '36310566', name: 'Tai Po Civic Centre', latitude: 22.4481, longitude: 114.1669 }\r\n    ];\r\n\r\n    // APIåŸºç¡€URL - åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™ä¸ªåº”è¯¥ä»ç¯å¢ƒå˜é‡ä¸­è·å–\r\n    const API_BASE_URL = 'http://localhost:3000';\r\n\r\n    // æ£€æŸ¥ç™»å½•çŠ¶æ€ï¼Œå¦‚æœæœªç™»å½•åˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢\r\n    useEffect(() => {\r\n        if (!authLoading && !isAuthenticated) {\r\n            navigate('/login');\r\n        }\r\n    }, [isAuthenticated, authLoading, navigate]);\r\n\r\n    // å¤„ç†é”®ç›˜äº‹ä»¶\r\n    useEffect(() => {\r\n        const handleKeyDown = (e) => {\r\n            if (e.key === 'Escape' && isCommentsPaneOpen) {\r\n                closeCommentsPane();\r\n            }\r\n        };\r\n\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        return () => window.removeEventListener('keydown', handleKeyDown);\r\n    }, [isCommentsPaneOpen]);\r\n\r\n    // åˆå§‹åŒ–åœ°å›¾ - åªåœ¨è®¤è¯åæ‰§è¡Œ\r\n    useEffect(() => {\r\n        if (!isAuthenticated || authLoading) return; // å¦‚æœæœªè®¤è¯æˆ–æ­£åœ¨éªŒè¯ï¼Œä¸åˆå§‹åŒ–åœ°å›¾\r\n\r\n        const initMap = () => {\r\n            if (!mapInstanceRef.current && mapRef.current) {\r\n                mapInstanceRef.current = L.map(mapRef.current).setView([22.3193, 114.1694], 12);\r\n                \r\n                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n                    attribution: '&copy; OpenStreetMap contributors',\r\n                    maxZoom: 18\r\n                }).addTo(mapInstanceRef.current);\r\n                \r\n                addMarkersToMap(mockLocations);\r\n            }\r\n        };\r\n\r\n        initMap();\r\n\r\n        // å¤„ç†æµè§ˆå™¨å†å²\r\n        const handlePopState = () => {\r\n            const url = new URL(window.location.href);\r\n            const locationId = url.searchParams.get('location');\r\n            \r\n            if (locationId) {\r\n                handleMarkerClick(locationId, false);\r\n            } else {\r\n                closeCommentsPane();\r\n            }\r\n        };\r\n\r\n        window.addEventListener('popstate', handlePopState);\r\n        \r\n        // åˆå§‹URLå¤„ç†\r\n        const url = new URL(window.location.href);\r\n        const initialLocationId = url.searchParams.get('location');\r\n        if (initialLocationId) {\r\n            handleMarkerClick(initialLocationId, false);\r\n        }\r\n\r\n        return () => {\r\n            if (mapInstanceRef.current) {\r\n                mapInstanceRef.current.remove();\r\n                mapInstanceRef.current = null;\r\n            }\r\n            window.removeEventListener('popstate', handlePopState);\r\n        };\r\n    }, [isAuthenticated, authLoading]);\r\n\r\n    // å¦‚æœæ­£åœ¨éªŒè¯èº«ä»½ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€\r\n    if (authLoading) {\r\n        return (\r\n            <div style={{\r\n                display: 'flex',\r\n                justifyContent: 'center',\r\n                alignItems: 'center',\r\n                minHeight: '100vh',\r\n                backgroundColor: '#f5f5f5'\r\n            }}>\r\n                <div style={{\r\n                    textAlign: 'center',\r\n                    padding: '2rem',\r\n                    borderRadius: '8px',\r\n                    backgroundColor: 'white',\r\n                    boxShadow: '0 2px 10px rgba(0,0,0,0.1)'\r\n                }}>\r\n                    <h3>Loading Map...</h3>\r\n                    <p>Please wait while we verify your session.</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // å¦‚æœæœªè®¤è¯ï¼Œè¿”å›ç©ºï¼ˆä¼šè¢«useEffecté‡å®šå‘ï¼‰\r\n    if (!isAuthenticated) {\r\n        return null;\r\n    }\r\n\r\n    // æ ·å¼å®šä¹‰\r\n    const styles = {\r\n        app: {\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            minHeight: '100vh',\r\n            margin: 0,\r\n            padding: 0,\r\n            boxSizing: 'border-box',\r\n            fontFamily: \"'Arial', sans-serif\",\r\n            lineHeight: 1.6,\r\n            color: '#333',\r\n            position: 'relative'\r\n        },\r\n        \r\n        header: {\r\n            background: 'linear-gradient(135deg, #2c3e50, #3498db)',\r\n            color: 'white',\r\n            padding: '1rem 2rem',\r\n            boxShadow: '0 2px 10px rgba(0, 0, 0, 0.1)',\r\n            zIndex: 1000,\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center'\r\n        },\r\n        \r\n        headerTitle: {\r\n            fontSize: '1.5rem',\r\n            margin: 0\r\n        },\r\n        \r\n        main: {\r\n            flex: 1,\r\n            display: 'flex',\r\n            position: 'relative',\r\n            overflow: 'hidden'\r\n        },\r\n        \r\n        mapContainer: {\r\n            flex: 1,\r\n            position: 'relative',\r\n            zIndex: 1\r\n        },\r\n        \r\n        mainMap: {\r\n            width: '100%',\r\n            height: '100%'\r\n        },\r\n        \r\n        // è¯„è®ºå¼¹çª—æ ·å¼\r\n        commentsPane: {\r\n            position: 'absolute',\r\n            top: 0,\r\n            left: 0,\r\n            width: '350px',\r\n            height: '100%',\r\n            background: 'white',\r\n            boxShadow: '2px 0 20px rgba(0, 0, 0, 0.15)',\r\n            zIndex: 100,\r\n            transform: isCommentsPaneOpen ? 'translateX(0)' : 'translateX(-100%)',\r\n            transition: 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            overflow: 'hidden'\r\n        },\r\n        \r\n        paneHeader: {\r\n            padding: '1.5rem',\r\n            background: 'linear-gradient(135deg, #2c3e50, #3498db)',\r\n            color: 'white',\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            flexShrink: 0\r\n        },\r\n        \r\n        paneTitle: {\r\n            margin: 0,\r\n            fontSize: '1.1rem',\r\n            fontWeight: '500'\r\n        },\r\n        \r\n        locationName: {\r\n            fontSize: '0.9rem',\r\n            opacity: 0.9,\r\n            marginTop: '0.25rem'\r\n        },\r\n        \r\n        closeButton: {\r\n            background: 'rgba(255, 255, 255, 0.2)',\r\n            border: 'none',\r\n            color: 'white',\r\n            width: '32px',\r\n            height: '32px',\r\n            borderRadius: '50%',\r\n            cursor: 'pointer',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            transition: 'background 0.3s',\r\n            fontSize: '1.2rem',\r\n            flexShrink: 0\r\n        },\r\n        \r\n        paneContent: {\r\n            flex: 1,\r\n            overflowY: 'auto',\r\n            padding: '1.5rem',\r\n            display: 'flex',\r\n            flexDirection: 'column'\r\n        },\r\n        \r\n        // è¯„è®ºéƒ¨åˆ†\r\n        commentsSection: {\r\n            flex: 1,\r\n            display: 'flex',\r\n            flexDirection: 'column'\r\n        },\r\n        \r\n        commentsCount: {\r\n            color: '#2c3e50',\r\n            marginBottom: '1rem',\r\n            paddingBottom: '0.75rem',\r\n            borderBottom: '2px solid #eee',\r\n            fontSize: '0.9rem',\r\n            fontWeight: '500'\r\n        },\r\n        \r\n        commentsList: {\r\n            flex: 1,\r\n            overflowY: 'auto',\r\n            marginBottom: '1.5rem'\r\n        },\r\n        \r\n        commentItem: {\r\n            padding: '1rem',\r\n            borderBottom: '1px solid #f0f0f0',\r\n            background: '#fafafa',\r\n            borderRadius: '8px',\r\n            marginBottom: '0.75rem'\r\n        },\r\n        \r\n        commentHeader: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            marginBottom: '0.5rem'\r\n        },\r\n        \r\n        commentAuthor: {\r\n            fontWeight: 'bold',\r\n            color: '#2c3e50',\r\n            fontSize: '0.9rem'\r\n        },\r\n        \r\n        commentDate: {\r\n            color: '#888',\r\n            fontSize: '0.8rem'\r\n        },\r\n        \r\n        commentText: {\r\n            color: '#555',\r\n            lineHeight: 1.5,\r\n            fontSize: '0.9rem'\r\n        },\r\n        \r\n        noComments: {\r\n            color: '#999',\r\n            textAlign: 'center',\r\n            padding: '3rem 1rem',\r\n            fontStyle: 'italic',\r\n            fontSize: '0.9rem'\r\n        },\r\n        \r\n        // æ·»åŠ è¯„è®ºè¡¨å•\r\n        addCommentSection: {\r\n            background: '#f8f9fa',\r\n            padding: '1.5rem',\r\n            borderRadius: '8px',\r\n            border: '1px solid #eaeaea',\r\n            flexShrink: 0\r\n        },\r\n        \r\n        commentFormTitle: {\r\n            color: '#2c3e50',\r\n            marginBottom: '1rem',\r\n            fontSize: '0.9rem',\r\n            fontWeight: '500'\r\n        },\r\n        \r\n        commentTextarea: {\r\n            width: '100%',\r\n            padding: '0.75rem',\r\n            border: '1px solid #ddd',\r\n            borderRadius: '6px',\r\n            resize: 'vertical',\r\n            marginBottom: '1rem',\r\n            fontFamily: 'inherit',\r\n            fontSize: '0.9rem',\r\n            minHeight: '80px',\r\n            transition: 'border-color 0.3s',\r\n            boxSizing: 'border-box'\r\n        },\r\n        \r\n        submitButton: {\r\n            background: '#3498db',\r\n            color: 'white',\r\n            border: 'none',\r\n            padding: '0.75rem 1.5rem',\r\n            borderRadius: '6px',\r\n            cursor: 'pointer',\r\n            fontSize: '0.9rem',\r\n            transition: 'background 0.3s',\r\n            width: '100%',\r\n            fontWeight: '500'\r\n        },\r\n        \r\n        submitButtonHover: {\r\n            background: '#2980b9'\r\n        },\r\n        \r\n        submitButtonDisabled: {\r\n            background: '#bdc3c7',\r\n            cursor: 'not-allowed'\r\n        },\r\n        \r\n        errorMessage: {\r\n            color: '#e74c3c',\r\n            fontSize: '0.9rem',\r\n            marginBottom: '1rem',\r\n            padding: '0.5rem',\r\n            background: '#fdf2f2',\r\n            borderRadius: '4px',\r\n            border: '1px solid #f8d7da'\r\n        },\r\n        \r\n        loadingIndicator: {\r\n            textAlign: 'center',\r\n            padding: '2rem',\r\n            color: '#666',\r\n            fontSize: '0.9rem'\r\n        },\r\n        \r\n        // å åŠ å±‚\r\n        overlay: {\r\n            position: 'absolute',\r\n            top: 0,\r\n            left: 0,\r\n            right: 0,\r\n            bottom: 0,\r\n            background: 'rgba(0, 0, 0, 0.4)',\r\n            zIndex: 50,\r\n            opacity: isCommentsPaneOpen ? 1 : 0,\r\n            visibility: isCommentsPaneOpen ? 'visible' : 'hidden',\r\n            transition: 'opacity 0.3s, visibility 0.3s',\r\n            cursor: 'pointer'\r\n        }\r\n    };\r\n\r\n    // æ·»åŠ æ ‡è®°åˆ°åœ°å›¾\r\n    const addMarkersToMap = (locationsData) => {\r\n        if (!mapInstanceRef.current) return;\r\n\r\n        // æ¸…é™¤ç°æœ‰æ ‡è®°\r\n        markersRef.current.forEach(marker => {\r\n            if (marker && mapInstanceRef.current) {\r\n                mapInstanceRef.current.removeLayer(marker);\r\n            }\r\n        });\r\n        markersRef.current = [];\r\n\r\n        // åˆ›å»ºè‡ªå®šä¹‰å›¾æ ‡\r\n        const createCustomIcon = (isSelected = false) => {\r\n            return L.divIcon({\r\n                className: 'custom-marker',\r\n                html: `\r\n                    <div style=\"\r\n                        background: ${isSelected ? '#e74c3c' : '#3498db'};\r\n                        width: 36px;\r\n                        height: 36px;\r\n                        border-radius: 50%;\r\n                        border: 3px solid white;\r\n                        box-shadow: 0 2px 8px rgba(0,0,0,0.3);\r\n                        display: flex;\r\n                        align-items: center;\r\n                        justify-content: center;\r\n                        color: white;\r\n                        font-weight: bold;\r\n                        font-size: 16px;\r\n                        transition: all 0.3s;\r\n                    \">\r\n                        <div style=\"transform: translateY(-1px)\">ğŸ“</div>\r\n                    </div>\r\n                `,\r\n                iconSize: [36, 36],\r\n                iconAnchor: [18, 36]\r\n            });\r\n        };\r\n\r\n        // æ·»åŠ æ–°æ ‡è®°\r\n        locationsData.forEach(location => {\r\n            const isSelected = selectedLocation === location.id;\r\n            const marker = L.marker([location.latitude, location.longitude], {\r\n                icon: createCustomIcon(isSelected)\r\n            })\r\n                .addTo(mapInstanceRef.current)\r\n                .bindTooltip(location.name, {\r\n                    direction: 'top',\r\n                    offset: [0, -18],\r\n                    opacity: 0.9,\r\n                    className: 'map-tooltip'\r\n                });\r\n            \r\n            // æ ‡è®°ç‚¹å‡»äº‹ä»¶\r\n            marker.on('click', () => {\r\n                handleMarkerClick(location.id, true);\r\n            });\r\n\r\n            markersRef.current.push(marker);\r\n        });\r\n    };\r\n\r\n    // ä»åç«¯APIè·å–è¯„è®º\r\n    const fetchComments = async (locationId) => {\r\n        if (!isAuthenticated) {\r\n            throw new Error('Authentication required');\r\n        }\r\n\r\n        setIsLoading(true);\r\n        setError('');\r\n        \r\n        try {\r\n            // è°ƒç”¨åç«¯APIè·å–æŸä¸ªåœ°ç‚¹çš„æ‰€æœ‰è¯„è®º\r\n            const response = await fetch(`${API_BASE_URL}/comment/loc-all/${locationId}`, {\r\n                credentials: 'include' // åŒ…å«è®¤è¯ä¿¡æ¯\r\n            });\r\n            \r\n            if (!response.ok) {\r\n                if (response.status === 401) {\r\n                    throw new Error('Authentication required. Please log in again.');\r\n                }\r\n                throw new Error(`Failed to fetch comments: ${response.status} ${response.statusText}`);\r\n            }\r\n            \r\n            const commentsData = await response.json();\r\n            \r\n            // å°†åç«¯æ•°æ®è½¬æ¢ä¸ºå‰ç«¯éœ€è¦çš„æ ¼å¼\r\n            const formattedComments = commentsData.map(comment => ({\r\n                id: comment.commentId || comment._id,\r\n                locationId: comment.locationId,\r\n                username: comment.username || 'Anonymous',\r\n                text: comment.content,\r\n                date: new Date(comment.timestamp).toLocaleDateString('en-US', { \r\n                    year: 'numeric', \r\n                    month: 'short', \r\n                    day: 'numeric' \r\n                }),\r\n                timestamp: comment.timestamp,\r\n                userId: comment.userId\r\n            }));\r\n            \r\n            return formattedComments;\r\n        } catch (error) {\r\n            console.error('Error fetching comments:', error);\r\n            setError(`Failed to load comments: ${error.message}`);\r\n            return [];\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    // å‘åç«¯APIæäº¤è¯„è®º\r\n    const submitComment = async (commentData) => {\r\n        if (!isAuthenticated) {\r\n            throw new Error('Authentication required');\r\n        }\r\n\r\n        setIsLoading(true);\r\n        setError('');\r\n        \r\n        try {\r\n            // è·å–è®¤è¯tokenï¼ˆå‡è®¾å­˜å‚¨åœ¨localStorageä¸­ï¼‰\r\n            const token = localStorage.getItem('authToken');\r\n            \r\n            const response = await fetch(`${API_BASE_URL}/comment/send`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    ...(token && { 'Authorization': `Bearer ${token}` })\r\n                },\r\n                credentials: 'include',\r\n                body: JSON.stringify({\r\n                    locID: commentData.locationId,\r\n                    content: commentData.text\r\n                })\r\n            });\r\n            \r\n            if (!response.ok) {\r\n                if (response.status === 401) {\r\n                    throw new Error('Authentication required. Please log in again.');\r\n                }\r\n                const errorData = await response.json().catch(() => ({}));\r\n                throw new Error(errorData.error || `Failed to submit comment: ${response.status}`);\r\n            }\r\n            \r\n            const result = await response.json();\r\n            \r\n            // è¿”å›æ–°åˆ›å»ºçš„è¯„è®º\r\n            return {\r\n                id: result.comment._id || Date.now(),\r\n                locationId: commentData.locationId,\r\n                username: commentData.username,\r\n                text: commentData.text,\r\n                date: new Date().toLocaleDateString('en-US', { \r\n                    year: 'numeric', \r\n                    month: 'short', \r\n                    day: 'numeric' \r\n                }),\r\n                timestamp: new Date().toISOString()\r\n            };\r\n        } catch (error) {\r\n            console.error('Error submitting comment:', error);\r\n            setError(`Failed to submit comment: ${error.message}`);\r\n            throw error;\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    // å¤„ç†æ ‡è®°ç‚¹å‡»\r\n    const handleMarkerClick = async (locationId, pushHistory = true) => {\r\n        if (!isAuthenticated) {\r\n            navigate('/login');\r\n            return;\r\n        }\r\n        \r\n        // æ‰¾åˆ°ä½ç½®ä¿¡æ¯\r\n        const location = mockLocations.find(loc => loc.id === locationId);\r\n        if (!location) return;\r\n        \r\n        // æ›´æ–°é€‰ä¸­çš„ä½ç½®\r\n        setSelectedLocation(locationId);\r\n        setLocationName(location.name);\r\n        \r\n        try {\r\n            // ä»APIåŠ è½½è¯„è®º\r\n            const locationComments = await fetchComments(locationId);\r\n            setComments(locationComments);\r\n        } catch (error) {\r\n            // å¦‚æœè®¤è¯å¤±è´¥ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢\r\n            if (error.message.includes('Authentication')) {\r\n                navigate('/login');\r\n                return;\r\n            }\r\n        }\r\n        \r\n        // æ‰“å¼€è¯„è®ºå¼¹çª—\r\n        setIsCommentsPaneOpen(true);\r\n        \r\n        // æ›´æ–°URLå¹¶æ¨å…¥å†å²è®°å½•ï¼ˆå¦‚æœéœ€è¦ï¼‰\r\n        if (pushHistory) {\r\n            const url = new URL(window.location.href);\r\n            url.searchParams.set('location', locationId);\r\n            window.history.pushState({ locationId }, '', url);\r\n        }\r\n        \r\n        // é‡æ–°æ¸²æŸ“æ ‡è®°ä»¥æ›´æ–°é€‰ä¸­çŠ¶æ€\r\n        addMarkersToMap(mockLocations);\r\n        \r\n        // å±…ä¸­æ˜¾ç¤ºé€‰ä¸­çš„æ ‡è®°\r\n        if (mapInstanceRef.current) {\r\n            mapInstanceRef.current.setView([location.latitude, location.longitude], 14);\r\n        }\r\n    };\r\n\r\n    // å…³é—­è¯„è®ºå¼¹çª—\r\n    const closeCommentsPane = () => {\r\n        setIsCommentsPaneOpen(false);\r\n        setSelectedLocation(null);\r\n        setLocationName('');\r\n        setComments([]);\r\n        setNewComment('');\r\n        setError('');\r\n        \r\n        // æ›´æ–°URL\r\n        const url = new URL(window.location.href);\r\n        url.searchParams.delete('location');\r\n        window.history.pushState({}, '', url);\r\n        \r\n        // é‡æ–°æ¸²æŸ“æ ‡è®°ä»¥æ¸…é™¤é€‰ä¸­çŠ¶æ€\r\n        addMarkersToMap(mockLocations);\r\n        \r\n        // é‡ç½®åœ°å›¾è§†å›¾\r\n        if (mapInstanceRef.current) {\r\n            mapInstanceRef.current.setView([22.3193, 114.1694], 12);\r\n        }\r\n    };\r\n\r\n    // æ·»åŠ è¯„è®º\r\n    const handleAddComment = async () => {\r\n        if (!isAuthenticated) {\r\n            navigate('/login');\r\n            return;\r\n        }\r\n        \r\n        if (newComment.trim() === '' || !selectedLocation) return;\r\n        \r\n        try {\r\n            // æ¨¡æ‹Ÿå½“å‰ç”¨æˆ·ï¼ˆåœ¨å®é™…åº”ç”¨ä¸­åº”è¯¥ä»ç™»å½•çŠ¶æ€è·å–ï¼‰\r\n            const currentUser = localStorage.getItem('currentUser') || 'Current User';\r\n            \r\n            const commentData = {\r\n                locationId: selectedLocation,\r\n                username: currentUser,\r\n                text: newComment.trim()\r\n            };\r\n            \r\n            // æäº¤è¯„è®ºåˆ°åç«¯API\r\n            const newCommentObj = await submitComment(commentData);\r\n            \r\n            // æ›´æ–°è¯„è®ºåˆ—è¡¨\r\n            setComments(prevComments => [...prevComments, newCommentObj]);\r\n            setNewComment('');\r\n            \r\n        } catch (error) {\r\n            console.error('Failed to add comment:', error);\r\n            // å¦‚æœè®¤è¯å¤±è´¥ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢\r\n            if (error.message.includes('Authentication')) {\r\n                navigate('/login');\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div style={styles.app}>\r\n            <header style={styles.header}>\r\n                <h1 style={styles.headerTitle}>Cultural Events Hong Kong</h1>\r\n            </header>\r\n            \r\n            <main style={styles.main}>\r\n                {/* åœ°å›¾å®¹å™¨ */}\r\n                <div style={styles.mapContainer}>\r\n                    <div ref={mapRef} style={styles.mainMap} />\r\n                </div>\r\n                \r\n                {/* è¯„è®ºå¼¹çª— */}\r\n                <div \r\n                    ref={paneRef}\r\n                    style={styles.commentsPane}\r\n                >\r\n                    <div style={styles.paneHeader}>\r\n                        <div>\r\n                            <h2 style={styles.paneTitle}>{locationName}</h2>\r\n                            {locationName && (\r\n                                <div style={styles.locationName}>\r\n                                    Comments\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                        <button \r\n                            onClick={closeCommentsPane}\r\n                            style={styles.closeButton}\r\n                            aria-label=\"Close comments pane\"\r\n                        >\r\n                            Ã—\r\n                        </button>\r\n                    </div>\r\n                    \r\n                    <div style={styles.paneContent}>\r\n                        <div style={styles.commentsSection}>\r\n                            <div style={styles.commentsCount}>\r\n                                {comments.length} {comments.length === 1 ? 'Comment' : 'Comments'}\r\n                            </div>\r\n                            \r\n                            {error && (\r\n                                <div style={styles.errorMessage}>\r\n                                    {error}\r\n                                </div>\r\n                            )}\r\n                            \r\n                            <div style={styles.commentsList}>\r\n                                {isLoading ? (\r\n                                    <div style={styles.loadingIndicator}>\r\n                                        Loading comments...\r\n                                    </div>\r\n                                ) : comments.length > 0 ? (\r\n                                    comments.map((comment) => (\r\n                                        <div key={comment.id} style={styles.commentItem}>\r\n                                            <div style={styles.commentHeader}>\r\n                                                <span style={styles.commentAuthor}>\r\n                                                    {comment.username}\r\n                                                </span>\r\n                                                <span style={styles.commentDate}>\r\n                                                    {comment.date}\r\n                                                </span>\r\n                                            </div>\r\n                                            <div style={styles.commentText}>\r\n                                                {comment.text}\r\n                                            </div>\r\n                                        </div>\r\n                                    ))\r\n                                ) : (\r\n                                    <div style={styles.noComments}>\r\n                                        No comments yet for this location.\r\n                                        <div style={{ marginTop: '0.5rem', fontSize: '0.8rem' }}>\r\n                                            Be the first to share your experience!\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                            \r\n                            <div style={styles.addCommentSection}>\r\n                                <div style={styles.commentFormTitle}>\r\n                                    Add a Comment\r\n                                </div>\r\n                                <textarea\r\n                                    value={newComment}\r\n                                    onChange={(e) => setNewComment(e.target.value)}\r\n                                    placeholder=\"Share your thoughts about this venue...\"\r\n                                    style={styles.commentTextarea}\r\n                                    rows=\"3\"\r\n                                    disabled={isLoading}\r\n                                />\r\n                                <button\r\n                                    onClick={handleAddComment}\r\n                                    style={{\r\n                                        ...styles.submitButton,\r\n                                        ...(newComment.trim() === '' || isLoading ? styles.submitButtonDisabled : {})\r\n                                    }}\r\n                                    disabled={newComment.trim() === '' || isLoading}\r\n                                >\r\n                                    {isLoading ? 'Posting...' : 'Post Comment'}\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                \r\n                {/* å åŠ å±‚ï¼ˆç‚¹å‡»å…³é—­å¼¹çª—ï¼‰ */}\r\n                {isCommentsPaneOpen && (\r\n                    <div \r\n                        style={styles.overlay}\r\n                        onClick={closeCommentsPane}\r\n                    />\r\n                )}\r\n            </main>\r\n            \r\n            <footer style={{\r\n                background: '#2c3e50',\r\n                color: 'white',\r\n                textAlign: 'center',\r\n                padding: '1rem',\r\n                fontSize: '0.9rem'\r\n            }}>\r\n                <p>Â© 2024 Cultural Events Web Application | Click on any marker to view and post comments</p>\r\n            </footer>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default MapPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}